---
title: NewBlog
date: 2024-02-03
categories: Project
excerpt: æœ‰ä¸€ä¸ªç”±è‡ªå·±æ‰“é€ çš„åšå®¢ï¼Œæ˜¯æ¯ä¸ªå‰ç«¯å¼€å‘å¿…å¤‡é¡¹ç›®ã€‚æˆ‘é€šè¿‡åŠä¸ªæœˆæ—¶é—´ï¼Œå°è¯•Nextæ­å»ºäº†ä¸€ä¸ªåšå®¢ã€‚
---

# å‰è¨€

åŸæœ¬ï¼Œæˆ‘åˆ©ç”¨ Hexo æ­å»ºäº†ä¸€ä¸ªä¸ªäººåšå®¢ï¼Œåˆšå¼€å§‹è¿˜æŒºæ–°é²œçš„ï¼Œä½†æ…¢æ…¢å°±è§‰å¾—æ ·å¼å•è°ƒï¼Œè€Œä¸”æˆ‘æƒ³åŠ å…¥è¯„è®ºä»¥åŠæµé‡ç›‘æ§å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥æƒ³ç€è¦ä¸è‡ªå·±æ‰‹å†™ä¸€ä¸ªï¼Œæ›´å¥½æ§åˆ¶ä¹Ÿèƒ½è‡ªå®šä¹‰æ ·å¼ã€‚äºæ˜¯ yyblog å°±å­•è‚²è€Œç”Ÿ

# ç»“æ„

æ•´ä¸ªåšå®¢ï¼Œä¸ä»…ä»…ç”± yyblog ç»„æˆï¼Œè¿˜æœ‰ ybg-cli è„šæ‰‹æ¶ï¼Œç”¨äºè‡ªåŠ¨åˆ›å»ºåˆ é™¤æ–‡ç« ä»¥åŠç¼–è¯‘æ–‡ç« ã€‚

- **yyblog**

  - Nextjs
  - typescript
  - tailwind
  - react-syntax-highlighter

- **ybg-cli**
  - cac
  - gray-matter
  - he

## yyblog

é‡‡ç”¨`Nextjs`+`Typescript`+`Tailwindw`ä¸ºä¸»è¦æŠ€æœ¯ã€‚

æ•ˆä»¿ Hexo é‡‡ç”¨çº¯å‰ç«¯ï¼Œæ–‡ç« ç¼–å†™åˆ é™¤ç¼–è¯‘éƒ½åœ¨æœ¬åœ°è¿è¡Œï¼Œå¯¹å‰ç«¯å·¥ç¨‹å¸ˆæ›´å‹å¥½ã€‚
Nextjs åŒæ—¶ä¹Ÿæ”¯æŒå…¨æ ˆå¼€å‘ã€‚ç®€å•çš„ sql è¯­å¥ä¹Ÿèƒ½å¤Ÿå¯¹æ–‡ç« è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚

Next æä¾›çš„æ–‡ä»¶è·¯ç”±åŒæ—¶ä¹Ÿå¯ä»¥å¸®æˆ‘ä»¬è‡ªå®šä¹‰ä¸€äº›ç‰¹æ®Šé¡µé¢ï¼Œå¸¸è§çš„ layout é¡µé¢ï¼Œ404 é¡µé¢ä»¥åŠé”™è¯¯é¡µé¢ç­‰ç­‰ã€‚

> é¿å…ä¸­æ–‡å‘½åæ–‡ä»¶ï¼ï¼

é™¤äº†æ–‡ä»¶è·¯ç”±ä»¥å¤–ï¼ŒNext ä¹Ÿæä¾›äº†å¾ˆå¤šç»„ä»¶ä»¥åŠä¼˜åŒ–ï¼Œæ¯”å¦‚ `font`ï¼Œ`<Image>`æ ‡ç­¾è¿˜æœ‰`<Script>`æ ‡ç­¾ã€‚
è¿™é‡Œè¯´ä¸€ä¸‹`<Script>`ï¼Œåšå®¢ç½‘ç«™ä¸Šæˆ‘æ”¾äº†ä¸€äº›åŠ¨ç”»(æ¥æºäº codepen),è€Œè¿™äº›åŠ¨ç”»`script`è„šæœ¬ï¼Œæ”¾å…¥ `tsx(jsx)` ä¸­åªèƒ½é€šè¿‡`dangerouslySetInnerHTML`è¿™ä¸ªæå…·é£é™©çš„ attribute
ä½†æ­£å¥½ Nextjs æä¾›äº†ä¸€ä¸ª`<Script>`ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬ä½¿ç”¨è„šæœ¬ç»„ä»¶ã€‚

## ybg-cli

é‡‡ç”¨çº¯å‰ç«¯çš„é‡ç‚¹å°±åœ¨äºæ–‡ç« çš„ç”Ÿæˆåˆ é™¤ä»¥åŠç¼–è¯‘ï¼Œéº»çƒ¦å°±éº»çƒ¦åœ¨ç¼–è¯‘æˆ TSX ä»£ç æ’å…¥åˆ° yyblog ä¸­å½¢æˆé¡µé¢ã€‚

å…‰çœ‹æ–‡å­—ä¸å¦‚ä¸Šç‚¹ä»£ç ï¼š

```typescript
export async function compileFile(): Promise<mdFile[]> {
  let compiledFiles: mdFile[] = [];
  const fileList = fs.readdirSync(_postFolder);
  for (const file of fileList) {
    const filePath = path.join(_postFolder, file);
    const fileContent = fs.readFileSync(filePath, "utf-8");
    const parsedFile = matter(fileContent);
    const newMatter = {
      ...parsedFile,
      data: { ...parsedFile.data, date: UTCToString(parsedFile.data.date) },
    };
    const picPath = makeImportPic(await marked(parsedFile.content));
    const htmlText = HtmlToNext(await marked(parsedFile.content));
    compiledFiles.push(
      picPath
        ? {
            mdMatter: newMatter,
            mdHtml: htmlText,
            other: {
              picPath: picPath,
            },
          }
        : { mdMatter: newMatter, mdHtml: htmlText },
    );
  }
  return compiledFiles;
}
```

è¯»å–æ–‡ä»¶å¹¶ä¸”ç”¨ gray-matter è§£æ md æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„å†…å®¹ã€‚
`mdMatter`æ˜¯æ–‡ç« å¤´éƒ¨`yaml`æ ¼å¼å†…å®¹çš„è§£æã€‚
`mdHtml`æ˜¯æ–‡ç« ä¸»é¢˜éƒ¨åˆ†çš„è§£æã€‚
`other`æ˜¯è§£ææˆ Html åéœ€è¦æ’å…¥åˆ°æœ€å TSX å†…å®¹çš„ä¸œè¥¿ã€‚

é‡ç‚¹åœ¨äº`HtmlToNext`å‡½æ•°:

```tsx
import he from "he";
function ImageRepimg(html: string) {
  const processedHtml = html.replace(
    /<img\s+src="(.*?)"\s+alt="(.*?)".*?\/>/g,
    function (match, src, alt) {
      const modifiedSrc = src.split("/");
      const newSrc = modifiedSrc[modifiedSrc.length - 1]; //ä¿®æ”¹åçš„SRC

      const modifiedAlt = alt; // ä¿®æ”¹åçš„alt

      return `<Image src={${newSrc.slice(
        0,
        newSrc.lastIndexOf("."),
      )}} alt="${modifiedAlt}" 
      sizes="100vw"
      style={{
        width: '100%',
        height: 'auto',
      }} />`;
    },
  );
  return processedHtml;
}
function replaceClassName(html: string) {
  const processedHtml = html.replace(/class=/g, "className=");
  return processedHtml;
}
function highLightHtml(html: string) {
  // åœ¨ä»£ç å—å†…çš„ç‰¹æ®Šå­—ç¬¦å‰åŠ ä¸Š \
  const replacedString1 = html.replace(
    /<pre><code className="language-(\w+)">([\s\S]*?)<\/code><\/pre>/g,
    (_, language, codeContent) => {
      //è½¬ä¹‰ç¬¦åˆ é™¤
      const decodeCode = he.decode(codeContent);
      const codeWithBackslash = decodeCode.replace(/([^\w\s"'])/g, "\\$1");
      return `<SyntaxHighlighter language="${language}" style={oneLight} showLineNumbers>{ \`${codeWithBackslash}\` }</SyntaxHighlighter>`;
    },
  );

  return replacedString1;
}
export function HtmlToNext(html: string) {
  //æ›¿æ¢imgæ ‡ç­¾
  const step1Html = ImageRepimg(html);
  //æ›¿æ¢classä¸ºclassName
  const step2Html = replaceClassName(step1Html);
  //é«˜äº®ä»£ç 
  const step3Html = highLightHtml(step2Html);
  //é—­åˆåˆ†å‰²çº¿
  const step4Html = step3Html.replace(/<hr>/g, "<hr />");
  return step4Html;
}
```

é€šè¿‡å¯¹è§£æå html çš„ä¿®æ”¹ï¼Œä¸»è¦æ˜¯ç”¨æ­£åˆ™ï¼Œå®ç° html å‘ TSX(Next)çš„è½¬åŒ–ã€‚

# 3æœˆ4å·æ›´æ–°ï¼š

æ›´æ–°äº†è‹±æ–‡ç‰ˆï¼Œä¸»è¦é‡‡ç”¨çš„æ˜¯Nextçš„ä¸­é—´ä»¶-`middleware.js`ä»¥åŠ`react-i18next`å’Œ`i18next`,è¿™ä¸¤ä¸ªåº“i18nè½¬åŒ–åº“ã€‚

```javascript
export function middleware(req) {
  let lng;
  if (req.cookies.has(cookieName))
    lng = acceptLanguage.get(req.cookies.get(cookieName).value);
  if (!lng) lng = acceptLanguage.get(req.headers.get("Accept-Language"));
  if (!lng) lng = fallbackLng;

  // Redirect if lng in path is not supported
  // è®°ä½ç”¨æˆ·é»˜è®¤ä½¿ç”¨çš„è¯­è¨€
  if (
    !languages.some((loc) => req.nextUrl.pathname.startsWith(`/${loc}`)) &&
    !req.nextUrl.pathname.startsWith("/_next")
  ) {
    return NextResponse.redirect(
      new URL(`/${lng}${req.nextUrl.pathname}`, req.url),
    );
  }
  // è·³è½¬é¡µé¢åŒæ—¶ä¿æŒè¯­è¨€è®¾ç½®
  if (req.headers.has("referer")) {
    const refererUrl = new URL(req.headers.get("referer"));
    const lngInReferer = languages.find((l) =>
      refererUrl.pathname.startsWith(`/${l}`),
    );
    const response = NextResponse.next();
    if (lngInReferer) response.cookies.set(cookieName, lngInReferer);
    return response;
  }

  return NextResponse.next();
}
```

è¿™ä¸€æ®µæ˜¯ä¸­é—´ä»¶ä¸»è¦çš„ä»£ç ï¼Œä½œç”¨æ˜¯ç”¨æˆ·ä½¿ç”¨ä¸æ”¯æŒè¯­è¨€æ—¶è‡ªåŠ¨è·³è½¬åˆ°é»˜è®¤è¯­è¨€ï¼Œè®°ä½ç”¨æˆ·æ¯æ¬¡ç»“æŸåä½¿ç”¨çš„è¯­è¨€ä»¥åŠé¡µé¢è·³è½¬æ—¶è®°ä½ç”¨æˆ·çš„è¯­è¨€é€‰æ‹©ã€‚

æœ€ååœ¨æ¯ä¸ªpageéƒ½ä½¿ç”¨`useTranslation`è½¬åŒ–è¯­è¨€ã€‚

```tsx
// About Page
export default async function Page({
  params: { language },
}: {
  params: { language: string };
}) {
  const { t } = await useTranslation(language, "translation");

  return (
    <div className=" mt-8 flex flex-col rounded bg-white px-4 py-3 text-start shadow-lg md:px-14 md:py-10 ">
      <div className="mb-5 cursor-default text-3xl font-bold">
        {t("AboutMe")}
      </div>
      <div className="ml-3 text-lg">
        <li className="mb-5">ğŸ’¬ {t("line1")}</li>
        <li className="mb-5">
          ğŸ‘¨â€ğŸ’» {t("line2")}
          <a
            href="https://redrock.team/"
            className=" hover-underline-animation text-visit-font no-underline"
          >
            {t("official")}
          </a>
        </li>
        <li className="mb-5">
          ğŸ¤{t("line3")}
          <a
            href="https://www.google.com/intl/zh-CN_cn/gmail/about/"
            className=" hover-underline-animation text-visit-font no-underline"
          >
            yeyan308911@gmail.com
          </a>
        </li>
        <li className="mb-5">ğŸŒ±{t("line4")}</li>
      </div>
    </div>
  );
}
```

# æ€»ç»“

åšå®¢æœ¬ä½“ä¸éš¾ï¼Œä¸»è¦æ˜¯åŠ¨ç”»å’Œç§»åŠ¨é€‚é…ç¨å¾®éº»çƒ¦ã€‚
CLI çš„éš¾ç‚¹åœ¨äºè§£ææ–‡ç« ä»¥åŠè·¯å¾„é—®é¢˜ã€‚

> ä¸€äº›ä½¿ç”¨åˆ°çš„åº“æˆ–è€…ä»£ç ï¼š

- [gray-matter](https://github.com/jonschlinkert/gray-matter)ï¼šè§£æé™æ€ç½‘é¡µå…ƒæ•°æ®
- [marked](https://github.com/markedjs/marked)ï¼šè½¬åŒ–`md`æ–‡ä»¶ä¸º HTML
- [rimraf](https://github.com/isaacs/rimraf)ï¼šå¿«æ·åˆ é™¤æ–‡ä»¶å¤¹åŠå…¶å†…å®¹
- [tsup](https://github.com/egoist/tsup)ï¼šå¿«é€Ÿæ„å»º TypeScript é¡¹ç›®çš„å·¥å…·
- [picocolors](https://github.com/alexeyraspopov/picocolors)ï¼šå‘½ä»¤è¡Œé¢œè‰²
- [cac](https://github.com/cacjs/cac)ï¼šæ„å»ºå‘½ä»¤è¡Œå·¥å…·çš„ JavaScript/TypeScript æ¡†æ¶
- [codepen](https://codepen.io/)ï¼š åŠ¨ç”»åŠç‰¹åˆ«çš„ 404 é¡µé¢éƒ½æ¥æºäºæ­¤
- [react-i18next](https://github.com/i18next/react-i18next) i18n for react
